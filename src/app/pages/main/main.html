<mat-sidenav-container class="layout h-screen w-screen">
  <mat-sidenav #sidenav [opened]="isShowSidebar()" (openedChange)="isShowSidebar.set($event)"
    [mode]="mobileQuery.matches ? 'over' : 'side'" [fixedInViewport]="mobileQuery.matches" class="layout-sidebar">
    <mat-nav-list class="w-full">
      @for (item of mainTreeData; track item) {

      <!-- 1) Cabeçalho para itens do tipo group -->
      @if (item.type === 'group') {
      <h6 class="px-4 mt-4 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wide">
        {{ item.name }}
      </h6>

      <!-- 2) Renderiza os filhos do grupo -->
      @for (section of item.children; track section) {

      <!-- 2a) Se o filho do grupo tiver children, ele é expansível -->
      @if (section.children?.length) {
      <mat-list-item (click)="toggleExpand(section)"
        class="cursor-pointer hover:bg-gray-100 transition flex items-center justify-between list-container-size">
        <div class="flex flex-row justify-between items-center w-full">
          <div class="flex flex-row gap-2 items-center">
            @if (section.icon) {
            <mat-icon matListIcon class="mr-4 color-primary">{{ section.icon }}</mat-icon> }
            <div class="text-sm font-medium">{{ section.name }}</div>
          </div>
          <mat-icon>{{ section.expanded ? 'expand_more' : 'chevron_right' }}</mat-icon>
        </div>
      </mat-list-item>

      <div class="pl-8 overflow-hidden transition-all duration-300 ease-in-out" [class.max-h-0]="!section.expanded"
        [class.max-h-96]="section.expanded">
        @for (leaf of section.children; track leaf) {
        <a mat-list-item [routerLink]="leaf.route" routerLinkActive="text-sm bg-gray-200 font-medium"
          class="cursor-pointer hover:bg-gray-100 transition list-container-size">
          <div class="text-sm font-medium ml-4">{{ leaf.name }}</div>
        </a>
        }
      </div>

      <!-- 2b) Se o filho do grupo NÃO tiver children, é link direto -->
      } @else {
      <a mat-list-item [routerLink]="section.route" routerLinkActive="!bg-gray-300 font-medium"
        class="group transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 list-container-size">
        <div class="flex flex-row gap-2 items-center">
          @if (section.icon) {
          <mat-icon matListIcon class="mr-2 color-primary group-hover:text-primary-600 transition-colors duration-200">
            {{ section.icon }}
          </mat-icon>
          }
          <div class="text-sm font-medium ml-2 group-hover:text-primary-800 transition-colors duration-200 self-center">
            {{ section.name }}
          </div>
        </div>
      </a>
      } }

      <!-- 3) Itens que NÃO são group -->
      } @else if (item.children?.length) {
      <!-- Item com submenu (nível raiz) -->
      <mat-list-item (click)="toggleExpand(item)"
        class="cursor-pointer hover:bg-gray-100 transition flex items-center justify-between list-container-size">
        <div class="flex flex-row justify-between items-center w-full">
          <div class="flex flex-row gap-2 items-center">
            <mat-icon matListIcon class="mr-4 color-primary">{{ item.icon }}</mat-icon>
            <div class="text-sm font-medium">{{ item.name }}</div>
          </div>
          <mat-icon>{{ item.expanded ? 'expand_more' : 'chevron_right' }}</mat-icon>
        </div>
      </mat-list-item>

      <div class="pl-8 overflow-hidden transition-all duration-300 ease-in-out" [class.max-h-0]="!item.expanded"
        [class.max-h-96]="item.expanded">
        @for (child of item.children; track child) {
        <a mat-list-item [routerLink]="child.route" routerLinkActive="text-sm bg-gray-200 font-medium"
          class="cursor-pointer hover:bg-gray-100 transition list-container-size">
          <div class="text-sm font-medium ml-4">{{ child.name }}</div>
        </a>
        }
      </div>

      } @else {
      <!-- Item simples (sem submenu) -->
      <a mat-list-item [routerLink]="item.route" routerLinkActive="!bg-gray-300 font-medium"
        class="group transition hover:bg-gray-50 rounded-sm list-container-size">
        <div class="flex flex-row gap-2 items-center ">
          <mat-icon matListIcon class="mr-2 color-primary group-hover:text-primary-600  transition-colors duration-200">
            {{ item.icon }}
          </mat-icon>
          <div class="text-sm font-medium ml-2 group-hover:text-primary-800 transition-colors duration-200 self-center">
            {{ item.name }}
          </div>
        </div>
      </a>
      } }
    </mat-nav-list>
  </mat-sidenav>

  <mat-sidenav-content>
    <div class="layout-content">
      <router-outlet>

        <mat-drawer-container class="">

          <mat-drawer-content class="flex text-sm font-medium">


            <mat-toolbar class="flex items-center px-4 h-14 ">

              <button matIconButton (click)="toggleSidebar()" aria-label="Example icon-button with menu icon"
                class="icon-btn">
                <mat-icon>menu</mat-icon>
              </button>


              <div class="flex gap-8 ml-4">
                <span class="tool-btn">App</span>
                <span class="tool-btn">Chat</span>
                <span class="tool-btn">Calendário</span>
                <span class="tool-btn">Email</span>
              </div>


              <div class="flex items-center gap-2 ml-auto">
                <button matIconButton class="icon-btn" aria-label="">
                  <mat-icon>logout</mat-icon>
                </button>
                <button matIconButton class="icon-btn" aria-label="">
                  <mat-icon>notifications</mat-icon>
                </button>
                <button matIconButton class="icon-btn" aria-label="">
                  <mat-icon>person</mat-icon>
                </button>
              </div>

            </mat-toolbar>

          </mat-drawer-content>
        </mat-drawer-container>

      </router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>